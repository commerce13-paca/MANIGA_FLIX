<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bajaj Secure - Madagascar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #2c5aa0;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--dark);
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow-x: hidden;
        }
        
        .app-container {
            background: white;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Header Styles */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, #1e3a8a 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 24px;
        }
        
        .logo-text {
            font-weight: bold;
            font-size: 18px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .header-icon {
            font-size: 20px;
            cursor: pointer;
        }
        
        /* Navigation */
        .app-nav {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 10px 0;
            border-top: 1px solid #e2e8f0;
            position: sticky;
            bottom: 0;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: var(--gray);
            font-size: 12px;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        /* Main Content */
        .app-content {
            padding: 15px;
            padding-bottom: 70px;
        }
        
        .welcome-section {
            background: linear-gradient(to right, var(--primary), #3b82f6);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .welcome-section::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }
        
        .welcome-section::after {
            content: "";
            position: absolute;
            bottom: -30px;
            right: 20px;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }
        
        .welcome-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .welcome-subtext {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Search Bar */
        .search-container {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-icon {
            color: var(--gray);
            font-size: 20px;
        }
        
        .search-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 16px;
            color: var(--dark);
        }
        
        .search-input::placeholder {
            color: var(--gray);
        }
        
        /* Quick Actions */
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .see-all {
            font-size: 14px;
            color: var(--primary);
            cursor: pointer;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .action-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .action-icon {
            width: 50px;
            height: 50px;
            background: var(--light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--primary);
        }
        
        .action-text {
            font-size: 12px;
            text-align: center;
            color: var(--dark);
        }
        
        /* Drivers List */
        .drivers-section {
            margin-bottom: 25px;
        }
        
        .driver-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            gap: 15px;
            align-items: center;
            cursor: pointer;
        }
        
        .driver-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }
        
        .driver-info {
            flex: 1;
        }
        
        .driver-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .driver-vehicle {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .driver-rating {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .rating-stars {
            color: var(--accent);
        }
        
        .rating-value {
            font-size: 14px;
            color: var(--gray);
        }
        
        .driver-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-available {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-busy {
            background: #fef3c7;
            color: #92400e;
        }
        
        .driver-distance {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }
        
        /* Map Container */
        .map-container {
            height: 300px;
            background: #e2e8f0;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
            border-radius: 12px;
        }
        
        .leaflet-container {
            background: #e2e8f0;
        }
        
        .map-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--gray);
        }
        
        .map-icon {
            font-size: 48px;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        /* Map Controls */
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            gap: 5px;
        }
        
        .map-btn {
            background: white;
            border: none;
            border-radius: 20px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Close Button */
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            z-index: 10;
        }
        
        /* Language Toggle */
        .language-toggle {
            position: fixed;
            top: 80px;
            right: 15px;
            background: white;
            border-radius: 20px;
            padding: 5px;
            display: flex;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 50;
        }
        
        .lang-btn {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            border: none;
            background: transparent;
            cursor: pointer;
        }
        
        .lang-btn.active {
            background: var(--primary);
            color: white;
        }
        
        /* Screens */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 200;
            padding: 20px;
            overflow-y: auto;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .auth-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .auth-subtitle {
            color: var(--gray);
            font-size: 14px;
        }
        
        .auth-options {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .auth-option {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .auth-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: border 0.3s;
        }
        
        .form-input:focus {
            border-color: var(--primary);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #1e3a8a;
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-google {
            background: white;
            color: var(--dark);
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-google:hover {
            background: #f8fafc;
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: var(--gray);
        }
        
        .auth-link {
            color: var(--primary);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--gray);
        }
        
        .divider::before, .divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .divider-text {
            padding: 0 15px;
            font-size: 14px;
        }
        
        /* Driver Profile */
        .driver-profile {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .profile-header {
            background: linear-gradient(to right, var(--primary), #3b82f6);
            padding: 20px;
            text-align: center;
            color: white;
            position: relative;
        }
        
        .profile-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid white;
            object-fit: cover;
            margin-bottom: 10px;
        }
        
        .profile-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .profile-vehicle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .profile-rating {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .profile-body {
            padding: 20px;
        }
        
        .info-group {
            margin-bottom: 20px;
        }
        
        .info-label {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 16px;
            font-weight: 500;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* Verification Badge */
        .verification-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #d1fae5;
            color: #065f46;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 5px;
        }
        
        /* Trip History */
        .trip-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .trip-info {
            flex: 1;
        }
        
        .trip-date {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .trip-route {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .trip-price {
            font-weight: 700;
            color: var(--primary);
        }
        
        .trip-rating {
            color: var(--accent);
        }
        
        /* User Profile */
        .user-profile {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .user-header {
            background: linear-gradient(to right, var(--primary), #3b82f6);
            padding: 20px;
            text-align: center;
            color: white;
            position: relative;
        }
        
        .user-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid white;
            object-fit: cover;
            margin-bottom: 10px;
            background: #ddd;
        }
        
        .user-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .user-email {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        /* Payment Screen */
        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .payment-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .payment-option:hover {
            border-color: var(--primary);
        }
        
        .payment-option.selected {
            border-color: var(--primary);
            background: #f0f7ff;
        }
        
        .payment-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .mvola-icon {
            background: #ff6b00;
        }
        
        .orange-money-icon {
            background: #ff6600;
        }
        
        .airtel-money-icon {
            background: #e60000;
        }
        
        .payment-info {
            flex: 1;
        }
        
        .payment-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .payment-description {
            font-size: 14px;
            color: var(--gray);
        }
        
        /* Ride Booking Screen */
        .ride-booking {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .location-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .location-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .location-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
        }
        
        .dot-start {
            background: var(--secondary);
        }
        
        .dot-end {
            background: var(--primary);
        }
        
        .location-field {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .price-estimate {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .price-total {
            font-weight: 700;
            font-size: 18px;
            color: var(--primary);
            border-top: 1px solid #e2e8f0;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        /* Bajaj Image */
        .bajaj-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        /* Regulations Info */
        .regulations-info {
            background: #f0f7ff;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .regulations-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .regulation-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .regulation-icon {
            color: var(--primary);
            margin-top: 2px;
        }
        
        /* Ads Section */
        .ads-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .ads-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .ad-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .ad-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            background: var(--accent);
        }
        
        .ad-info {
            flex: 1;
        }
        
        .ad-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .ad-description {
            font-size: 14px;
            color: var(--gray);
        }
        
        .ad-reward {
            font-weight: 600;
            color: var(--secondary);
        }
        
        /* Wallet Screen */
        .wallet-balance {
            background: linear-gradient(to right, var(--primary), #3b82f6);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .balance-amount {
            font-size: 32px;
            font-weight: 700;
        }
        
        /* History Screen */
        .history-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Active when screens are shown */
        .hidden {
            display: none;
        }
        
        /* Animation for switching content */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
        }
        
        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Language Toggle -->
        <div class="language-toggle">
            <button class="lang-btn active" id="fr-btn">FR</button>
            <button class="lang-btn" id="mg-btn">MG</button>
        </div>
        
        <!-- App Header -->
        <header class="app-header">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-motorcycle"></i></div>
                <div class="logo-text">Bajaj Secure</div>
            </div>
            <div class="header-actions">
                <div class="header-icon"><i class="fas fa-bell"></i></div>
                <div class="header-icon"><i class="fas fa-user" id="profile-btn"></i></div>
            </div>
        </header>
        
        <!-- Main Content (shown when user is logged in) -->
        <div class="app-content" id="main-content">
            <!-- Welcome Section -->
            <div class="welcome-section">
                <div class="welcome-text" id="welcome-text">Bonjour à Mahajanga!</div>
                <div class="welcome-subtext" id="welcome-subtext">Réservez votre Bajaj en toute sécurité</div>
            </div>
            
            <!-- Bajaj Image -->
            <img src="https://mcusercontent.com/91c139bf21c12fb6688667dc7/images/331066df-ae56-9e10-0bc8-02861b11d8dd.png" alt="Bajaj Mahajanga" class="bajaj-image">
            
            <!-- Regulations Info -->
            <div class="regulations-info">
                <div class="regulations-title">Réglementation Bajaj Mahajanga</div>
                <div class="regulation-item">
                    <div class="regulation-icon"><i class="fas fa-users"></i></div>
                    <div>Maximum 3 passagers par bajaj</div>
                </div>
                <div class="regulation-item">
                    <div class="regulation-icon"><i class="fas fa-tachometer-alt"></i></div>
                    <div>Vitesse limitée à 40 km/h</div>
                </div>
                <div class="regulation-item">
                    <div class="regulation-icon"><i class="fas fa-suitcase"></i></div>
                    <div>Bagages limités à 50kg</div>
                </div>
                <div class="regulation-item">
                    <div class="regulation-icon"><i class="fas fa-map-marker-alt"></i></div>
                    <div>Interdit à l'aéroport d'Amborovy</div>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-icon"><i class="fas fa-search"></i></div>
                <input type="text" class="search-input" id="search-input" placeholder="Rechercher une destination...">
            </div>
            
            <!-- Map Section -->
            <div class="map-container">
                <div id="map"></div>
                <div class="map-controls">
                    <button class="map-btn" id="locate-btn">
                        <i class="fas fa-location-arrow"></i>
                    </button>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="section-title">
                <span id="quick-actions-title">Actions Rapides</span>
                <span class="see-all">Voir tout</span>
            </div>
            
            <div class="quick-actions">
                <div class="action-item" id="book-ride-btn">
                    <div class="action-icon"><i class="fas fa-motorcycle"></i></div>
                    <div class="action-text" id="action-ride">Réserver</div>
                </div>
                <div class="action-item" id="history-btn">
                    <div class="action-icon"><i class="fas fa-history"></i></div>
                    <div class="action-text" id="action-history">Historique</div>
                </div>
                <div class="action-item" id="ratings-btn">
                    <div class="action-icon"><i class="fas fa-star"></i></div>
                    <div class="action-text" id="action-ratings">Notes</div>
                </div>
                <div class="action-item" id="wallet-btn">
                    <div class="action-icon"><i class="fas fa-wallet"></i></div>
                    <div class="action-text" id="action-wallet">Portefeuille</div>
                </div>
            </div>
            
            <!-- Ads Section -->
            <div class="ads-section">
                <div class="ads-title">Gagnez de l'argent</div>
                <div class="ad-item" id="watch-ad-btn">
                    <div class="ad-icon"><i class="fas fa-play-circle"></i></div>
                    <div class="ad-info">
                        <div class="ad-name">Regarder une publicité</div>
                        <div class="ad-description">Regardez une vidéo de 30 secondes</div>
                    </div>
                    <div class="ad-reward">+100 Ar</div>
                </div>
                <div class="ad-item" id="survey-btn">
                    <div class="ad-icon"><i class="fas fa-clipboard-list"></i></div>
                    <div class="ad-info">
                        <div class="ad-name">Répondre à un sondage</div>
                        <div class="ad-description">5 minutes de votre temps</div>
                    </div>
                    <div class="ad-reward">+500 Ar</div>
                </div>
            </div>
            
            <!-- Drivers Section -->
            <div class="drivers-section">
                <div class="section-title">
                    <span id="drivers-title">Bajajs à Proximité</span>
                    <span class="see-all">Voir tout</span>
                </div>
                
                <div class="driver-card" data-driver-id="1">
                    <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Driver" class="driver-photo">
                    <div class="driver-info">
                        <div class="driver-name">Rakoto Jean</div>
                        <div class="driver-vehicle">Bajaj Jaune • 1245 TB</div>
                        <div class="driver-rating">
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <div class="rating-value">4.5</div>
                        </div>
                        <div class="driver-distance">À 0.8 km • 5 min</div>
                    </div>
                    <div class="driver-status status-available">Disponible</div>
                </div>
                
                <div class="driver-card" data-driver-id="2">
                    <img src="https://randomuser.me/api/portraits/men/44.jpg" alt="Driver" class="driver-photo">
                    <div class="driver-info">
                        <div class="driver-name">Rasoa Marie</div>
                        <div class="driver-vehicle">Bajaj Bleu • 5687 TB</div>
                        <div class="driver-rating">
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                            </div>
                            <div class="rating-value">4.0</div>
                        </div>
                        <div class="driver-distance">À 1.2 km • 7 min</div>
                    </div>
                    <div class="driver-status status-busy">En course</div>
                </div>
                
                <div class="driver-card" data-driver-id="3">
                    <img src="https://randomuser.me/api/portraits/men/76.jpg" alt="Driver" class="driver-photo">
                    <div class="driver-info">
                        <div class="driver-name">Rabe Patrick</div>
                        <div class="driver-vehicle">Bajaj Vert • 9821 TB</div>
                        <div class="driver-rating">
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="rating-value">5.0</div>
                        </div>
                        <div class="driver-distance">À 0.5 km • 3 min</div>
                    </div>
                    <div class="driver-status status-available">Disponible</div>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <nav class="app-nav">
            <div class="nav-item active" id="nav-home">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-text">Accueil</div>
            </div>
            <div class="nav-item" id="nav-map">
                <div class="nav-icon"><i class="fas fa-map-marker-alt"></i></div>
                <div class="nav-text">Carte</div>
            </div>
            <div class="nav-item" id="nav-offers">
                <div class="nav-icon"><i class="fas fa-ticket-alt"></i></div>
                <div class="nav-text">Offres</div>
            </div>
            <div class="nav-item" id="nav-settings">
                <div class="nav-icon"><i class="fas fa-cog"></i></div>
                <div class="nav-text">Paramètres</div>
            </div>
        </nav>
        
        <!-- Authentication Screen -->
        <div class="screen hidden" id="auth-screen">
            <button class="close-btn" id="close-auth-btn">
                <i class="fas fa-times"></i>
            </button>
            <div class="auth-header">
                <div class="auth-title" id="auth-title">Connexion</div>
                <div class="auth-subtitle" id="auth-subtitle">Connectez-vous à votre compte</div>
            </div>
            
            <div class="error-message" id="auth-error"></div>
            <div class="success-message" id="auth-success"></div>
            
            <div class="auth-options">
                <div class="auth-option active" id="passenger-option">Passager</div>
                <div class="auth-option" id="driver-option">Chauffeur</div>
            </div>
            
            <div id="login-form">
                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input type="email" class="form-input" id="email" placeholder="votre@email.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Mot de passe</label>
                    <input type="password" class="form-input" id="password" placeholder="Entrez votre mot de passe">
                </div>
                
                <button class="btn btn-primary" id="login-btn">
                    <span id="login-btn-text">Se connecter</span>
                    <div class="spinner hidden" id="login-spinner"></div>
                </button>
                
                <div class="divider">
                    <div class="divider-text">Ou</div>
                </div>
                
                <button class="btn btn-google" id="google-login-btn">
                    <i class="fab fa-google"></i>
                    <span>Se connecter avec Google</span>
                </button>
                
                <div class="auth-footer">
                    <span id="auth-footer-text">Vous n'avez pas de compte?</span>
                    <a class="auth-link" id="show-register-link">S'inscrire</a>
                </div>
            </div>
            
            <div id="register-form" class="hidden">
                <div class="form-group">
                    <label class="form-label" for="register-name">Nom complet</label>
                    <input type="text" class="form-input" id="register-name" placeholder="Votre nom complet">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="register-email">Email</label>
                    <input type="email" class="form-input" id="register-email" placeholder="votre@email.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="register-password">Mot de passe</label>
                    <input type="password" class="form-input" id="register-password" placeholder="Créez un mot de passe">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="register-confirm">Confirmer le mot de passe</label>
                    <input type="password" class="form-input" id="register-confirm" placeholder="Confirmez votre mot de passe">
                </div>
                
                <button class="btn btn-primary" id="register-btn">
                    <span id="register-btn-text">S'inscrire</span>
                    <div class="spinner hidden" id="register-spinner"></div>
                </button>
                
                <div class="divider">
                    <div class="divider-text">Ou</div>
                </div>
                
                <button class="btn btn-google" id="google-register-btn">
                    <i class="fab fa-google"></i>
                    <span>S'inscrire avec Google</span>
                </button>
                
                <div class="auth-footer">
                    <span>Vous avez déjà un compte?</span>
                    <a class="auth-link" id="show-login-link">Se connecter</a>
                </div>
            </div>
        </div>
        
        <!-- User Profile Screen -->
        <div class="screen hidden" id="user-profile-screen">
            <button class="close-btn" id="close-profile-btn">
                <i class="fas fa-times"></i>
            </button>
            <div class="auth-header">
                <div class="auth-title">Mon Profil</div>
                <div class="auth-subtitle">Informations de votre compte</div>
            </div>
            
            <div class="user-profile">
                <div class="user-header">
                    <div class="user-photo" id="user-photo">
                        <i class="fas fa-user" style="font-size: 40px; line-height: 100px; color: white;"></i>
                    </div>
                    <div class="user-name" id="user-display-name">Utilisateur</div>
                    <div class="user-email" id="user-email">utilisateur@example.com</div>
                </div>
                
                <div class="profile-body">
                    <div class="info-group">
                        <div class="info-label">Type de compte</div>
                        <div class="info-value" id="user-type">Passager</div>
                    </div>
                    
                    <div class="info-group">
                        <div class="info-label">Membre depuis</div>
                        <div class="info-value" id="user-join-date">Janvier 2023</div>
                    </div>
                    
                    <div class="info-group">
                        <div class="info-label">Nombre de courses</div>
                        <div class="info-value">24</div>
                    </div>
                    
                    <div class="stats-container">
                        <div class="stat-item">
                            <div class="stat-value">4.8</div>
                            <div class="stat-label">Note moyenne</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">12</div>
                            <div class="stat-label">Chauffeurs favoris</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">85%</div>
                            <div class="stat-label">Taux de ponctualité</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" style="margin-top: 20px;" id="edit-profile-btn">Modifier le profil</button>
            <button class="btn" style="margin-top: 10px; background: #f8fafc; color: var(--dark);" id="logout-btn">Se déconnecter</button>
        </div>
        
        <!-- Ride Booking Screen -->
        <div class="screen hidden" id="ride-booking-screen">
            <button class="close-btn" id="close-booking-btn">
                <i class="fas fa-times"></i>
            </button>
            <div class="auth-header">
                <div class="auth-title">Réserver un Bajaj</div>
                <div class="auth-subtitle">Choisissez votre destination</div>
            </div>
            
            <div class="ride-booking">
                <div class="location-inputs">
                    <div class="location-input">
                        <div class="location-dot dot-start"><i class="fas fa-circle"></i></div>
                        <input type="text" class="location-field" id="start-location" placeholder="Votre position actuelle" value="Mahajanga Centre">
                    </div>
                    <div class="location-input">
                        <div class="location-dot dot-end"><i class="fas fa-map-marker-alt"></i></div>
                        <input type="text" class="location-field" id="end-location" placeholder="Destination">
                    </div>
                </div>
                
                <div class="price-estimate">
                    <div class="price-row">
                        <span>Prix estimé:</span>
                        <span id="ride-price">1,500 Ar</span>
                    </div>
                    <div class="price-row">
                        <span>Commission Bajaj Secure (10%):</span>
                        <span id="commission-price">150 Ar</span>
                    </div>
                    <div class="price-row price-total">
                        <span>Total:</span>
                        <span id="total-price">1,650 Ar</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nombre de passagers (max 3)</label>
                    <select class="form-input" id="passenger-count">
                        <option value="1">1 passager</option>
                        <option value="2">2 passagers</option>
                        <option value="3">3 passagers</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" id="confirm-booking-btn">Confirmer la réservation</button>
            </div>
        </div>
        
        <!-- Payment Screen -->
        <div class="screen hidden" id="payment-screen">
            <button class="close-btn" id="close-payment-btn">
                <i class="fas fa-times"></i>
            </button>
            <div class="auth-header">
                <div class="auth-title">Paiement</div>
                <div class="auth-subtitle">Choisissez votre méthode de paiement</div>
            </div>
            
            <div class="price-estimate" style="margin-top: 20px;">
                <div class="price-row">
                    <span>Montant à payer:</span>
                    <span id="payment-amount">1,650 Ar</span>
                </div>
            </div>
            
            <div class="payment-options">
                <div class="payment-option selected" data-payment="mvola">
                    <div class="payment-icon mvola-icon"><i class="fas fa-mobile-alt"></i></div>
                    <div class="payment-info">
                        <div class="payment-name">Mvola</div>
                        <div class="payment-description">Paiement via Mvola</div>
                    </div>
                    <div><i class="fas fa-check-circle" style="color: var(--secondary);"></i></div>
                </div>
                
                <div class="payment-option" data-payment="orange">
                    <div class="payment-icon orange-money-icon"><i class="fas fa-money-bill-wave"></i></div>
                    <div class="payment-info">
                        <div class="payment-name">Orange Money</div>
                        <div class="payment-description">Paiement via Orange Money</div>
                    </div>
                    <div><i class="far fa-circle" style="color: var(--gray);"></i></div>
                </div>
                
                <div class="payment-option" data-payment="airtel">
                    <div class="payment-icon airtel-money-icon"><i class="fas fa-wallet"></i></div>
                    <div class="payment-info">
                        <div class="payment-name">Airtel Money</div>
                        <div class="payment-description">Paiement via Airtel Money</div>
                    </div>
                    <div><i class="far fa-circle" style="color: var(--gray);"></i></div>
                </div>
            </div>
            
            <button class="btn btn-primary" id="confirm-payment-btn">Payer maintenant</button>
            <button class="btn" style="margin-top: 10px; background: #f8fafc; color: var(--dark);" id="back-to-booking-btn">Retour</button>
        </div>
        
        <!-- Wallet Screen -->
        <div class="screen hidden" id="wallet-screen">
            <button class="close-btn" id="close-wallet-btn">
                <i class="fas fa-times"></i>
            </button>
            <div class="auth-header">
                <div class="auth-title">Mon Portefeuille</div>
                <div class="auth-subtitle">Gérez votre solde et vos transactions</div>
            </div>
            
            <div class="wallet-balance">
                <div class="balance-label">Solde disponible</div>
                <div class="balance-amount" id="wallet-balance">12,500 Ar</div>
            </div>
            
            <div class="section-title">
                <span>Transactions récentes</span>
            </div>
            
            <div class="trip-item">
                <div class="trip-info">
                    <div class="trip-date">Aujourd'hui, 10:23</div>
                    <div class="trip-route">Course - Mahajanga Centre → Analakely</div>
                    <div class="trip-price">- 1,650 Ar</div>
                </div>
            </div>
            
            <div class="trip-item">
                <div class="trip-info">
                    <div class="trip-date">Hier, 18:45</div>
                    <div class="trip-route">Publicité visionnée</div>
                    <div class="trip-price" style="color: var(--secondary);">+ 100 Ar</div>
                </div>
            </div>
            
            <div class="trip-item">
                <div class="trip-info">
                    <div class="trip-date">Hier, 15:30</div>
                    <div class="trip-route">Course - Isoraka → Ampandrana</div>
                    <div class="trip-price">- 2,800 Ar</div>
                </div>
            </div>
            
            <button class="btn btn-primary" style="margin-top: 20px;" id="add-money-btn">Ajouter des fonds</button>
        </div>
        
        <!-- History Screen -->
        <div class="screen hidden" id="history-screen">
            <button class="close-btn" id="close-history-btn">
                <i class="fas fa-times"></i>
            </button>
            <div class="auth-header">
                <div class="auth-title">Historique des courses</div>
                <div class="auth-subtitle">Vos trajets précédents</div>
            </div>
            
            <div class="history-filters">
                <button class="filter-btn active">Tous</button>
                <button class="filter-btn">Cette semaine</button>
                <button class="filter-btn">Ce mois</button>
            </div>
            
            <div class="trip-item">
                <div class="trip-info">
                    <div class="trip-date">Aujourd'hui, 10:23</div>
                    <div class="trip-route">Mahajanga Centre → Analakely</div>
                    <div class="trip-price">1,650 Ar</div>
                </div>
                <div class="trip-rating">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
            </div>
            
            <div class="trip-item">
                <div class="trip-info">
                    <div class="trip-date">Hier, 18:45</div>
                    <div class="trip-route">Isoraka → Ampandrana</div>
                    <div class="trip-price">2,800 Ar</div>
                </div>
                <div class="trip-rating">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="far fa-star"></i>
                </div>
            </div>
            
            <div class="trip-item">
                <div class="trip-info">
                    <div class="trip-date">12 Avril 2024</div>
                    <div class="trip-route">Mahajanga Centre → Petite Plage</div>
                    <div class="trip-price">2,200 Ar</div>
                </div>
                <div class="trip-rating">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                </div>
            </div>
        </div>
        
        <!-- Ratings Screen -->
        <div class="screen hidden" id="ratings-screen">
            <button class="close-btn" id="close-ratings-btn">
                <i class="fas fa-times"></i>
            </button>
            <div class="auth-header">
                <div class="auth-title">Mes Notes</div>
                <div class="auth-subtitle">Vos évaluations des chauffeurs</div>
            </div>
            
            <div class="driver-card">
                <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Driver" class="driver-photo">
                <div class="driver-info">
                    <div class="driver-name">Rakoto Jean</div>
                    <div class="driver-vehicle">Bajaj Jaune • 1245 TB</div>
                    <div class="driver-rating">
                        <div class="rating-stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="rating-value">5.0</div>
                    </div>
                    <div class="driver-distance">Aujourd'hui, 10:23</div>
                </div>
            </div>
            
            <div class="driver-card">
                <img src="https://randomuser.me/api/portraits/men/44.jpg" alt="Driver" class="driver-photo">
                <div class="driver-info">
                    <div class="driver-name">Rasoa Marie</div>
                    <div class="driver-vehicle">Bajaj Bleu • 5687 TB</div>
                    <div class="driver-rating">
                        <div class="rating-stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <div class="rating-value">4.0</div>
                    </div>
                    <div class="driver-distance">Hier, 18:45</div>
                </div>
            </div>
            
            <div class="driver-card">
                <img src="https://randomuser.me/api/portraits/men/76.jpg" alt="Driver" class="driver-photo">
                <div class="driver-info">
                    <div class="driver-name">Rabe Patrick</div>
                    <div class="driver-vehicle">Bajaj Vert • 9821 TB</div>
                    <div class="driver-rating">
                        <div class="rating-stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <div class="rating-value">4.5</div>
                    </div>
                    <div class="driver-distance">12 Avril 2024</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDZsgZuAfDCCQie8Zdgs2b-liXNGmbcj0A",
            authDomain: "salon-de-lissage-lirina.firebaseapp.com",
            projectId: "salon-de-lissage-lirina",
            storageBucket: "salon-de-lissage-lirina.firebasestorage.app",
            messagingSenderId: "1076363528985",
            appId: "1:1076363528985:web:e72b30009c33315809d388",
            measurementId: "G-P75QP0VRE7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // État de l'application
        let currentUser = null;
        let map = null;
        let userMarker = null;

        // Initialiser la carte
        function initMap() {
            // Centrer sur Mahajanga par défaut
            map = L.map('map').setView([-15.7167, 46.3167], 13);
            
            // Ajouter la couche de carte
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            
            // Bouton de localisation
            document.getElementById('locate-btn').addEventListener('click', locateUser);
        }

        // Localiser l'utilisateur
        function locateUser() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;
                        
                        // Mettre à jour ou créer le marqueur
                        if (userMarker) {
                            userMarker.setLatLng([userLat, userLng]);
                        } else {
                            userMarker = L.marker([userLat, userLng])
                                .addTo(map)
                                .bindPopup('Votre position')
                                .openPopup();
                        }
                        
                        // Centrer la carte sur la position
                        map.setView([userLat, userLng], 15);
                    },
                    (error) => {
                        alert('Impossible de récupérer votre position');
                    }
                );
            } else {
                alert('La géolocalisation n\'est pas supportée par votre navigateur');
            }
        }

        // Références aux éléments
        const mainContent = document.getElementById('main-content');
        const authScreen = document.getElementById('auth-screen');
        const userProfileScreen = document.getElementById('user-profile-screen');
        const rideBookingScreen = document.getElementById('ride-booking-screen');
        const paymentScreen = document.getElementById('payment-screen');
        const walletScreen = document.getElementById('wallet-screen');
        const historyScreen = document.getElementById('history-screen');
        const ratingsScreen = document.getElementById('ratings-screen');

        // Fonctions de navigation
        function showScreen(screen) {
            // Cacher tous les écrans
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            mainContent.classList.add('hidden');
            
            // Afficher l'écran demandé
            screen.classList.remove('hidden');
        }

        function showMainApp() {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            mainContent.classList.remove('hidden');
        }

        // Événements de navigation
        document.getElementById('profile-btn').addEventListener('click', () => {
            if (currentUser) {
                showScreen(userProfileScreen);
            } else {
                showScreen(authScreen);
            }
        });

        // Boutons de fermeture
        document.getElementById('close-auth-btn').addEventListener('click', showMainApp);
        document.getElementById('close-profile-btn').addEventListener('click', showMainApp);
        document.getElementById('close-booking-btn').addEventListener('click', showMainApp);
        document.getElementById('close-payment-btn').addEventListener('click', showMainApp);
        document.getElementById('close-wallet-btn').addEventListener('click', showMainApp);
        document.getElementById('close-history-btn').addEventListener('click', showMainApp);
        document.getElementById('close-ratings-btn').addEventListener('click', showMainApp);

        // Actions rapides
        document.getElementById('book-ride-btn').addEventListener('click', () => {
            if (currentUser) {
                showScreen(rideBookingScreen);
            } else {
                showScreen(authScreen);
            }
        });

        document.getElementById('history-btn').addEventListener('click', () => {
            if (currentUser) {
                showScreen(historyScreen);
            } else {
                showScreen(authScreen);
            }
        });

        document.getElementById('ratings-btn').addEventListener('click', () => {
            if (currentUser) {
                showScreen(ratingsScreen);
            } else {
                showScreen(authScreen);
            }
        });

        document.getElementById('wallet-btn').addEventListener('click', () => {
            if (currentUser) {
                showScreen(walletScreen);
            } else {
                showScreen(authScreen);
            }
        });

        // Authentification
        document.getElementById('show-register-link').addEventListener('click', () => {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        });

        document.getElementById('show-login-link').addEventListener('click', () => {
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        });

        // Connexion
        document.getElementById('login-btn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                showMainApp();
            } catch (error) {
                alert('Erreur de connexion: ' + error.message);
            }
        });

        // Inscription
        document.getElementById('register-btn').addEventListener('click', async () => {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            
            if (!name || !email || !password || !confirm) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            if (password !== confirm) {
                alert('Les mots de passe ne correspondent pas');
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });
                currentUser = userCredential.user;
                showMainApp();
            } catch (error) {
                alert('Erreur d\'inscription: ' + error.message);
            }
        });

        // Déconnexion
        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                await auth.signOut();
                currentUser = null;
                showMainApp();
            } catch (error) {
                console.error('Erreur de déconnexion:', error);
            }
        });

        // Réservation
        document.getElementById('confirm-booking-btn').addEventListener('click', () => {
            showScreen(paymentScreen);
        });

        document.getElementById('back-to-booking-btn').addEventListener('click', () => {
            showScreen(rideBookingScreen);
        });

        // Paiement
        document.getElementById('confirm-payment-btn').addEventListener('click', () => {
            alert('Paiement simulé avec succès!');
            showMainApp();
        });

        // Gestion de l'état d'authentification
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                showMainApp();
                // Localiser automatiquement l'utilisateur après connexion
                setTimeout(locateUser, 1000);
            } else {
                showScreen(authScreen);
            }
        });

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            // L'état d'authentification est géré par onAuthStateChanged
        });
    </script>
</body>
    </html>
